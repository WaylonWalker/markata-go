{% extends "base.html" %}

{% block title %}{{ post.title }} | {{ config.title | default:'My Site' }}{% endblock %}
{% block description %}{{ post.description | default:'' }}{% endblock %}

{% block meta %}
{{ block.Super() }}
{# Canonical URL for SEO #}
<link rel="canonical" href="{{ config.url }}{{ post.href }}">

{# Alternate format links #}
{% if config.post_formats.markdown %}
<link rel="alternate" type="text/markdown" title="Markdown Source" href="/{{ post.slug }}.md">
{% endif %}
{% if config.post_formats.text %}
<link rel="alternate" type="text/plain" title="Plain Text" href="/{{ post.slug }}.txt">
{% endif %}
{% if config.post_formats.og %}
<link rel="alternate" type="text/html" title="Social Card" href="{{ post.href }}og/">
{% endif %}

{# Structured Data: JSON-LD #}
{% if post.structured_data.jsonld %}
<script type="application/ld+json">
{{ post.structured_data.jsonld | safe }}
</script>
{% endif %}

{# Structured Data: OpenGraph meta tags #}
{% if post.structured_data.opengraph %}
{% for meta in post.structured_data.opengraph %}
<meta property="{{ meta.property }}" content="{{ meta.content }}">
{% endfor %}
{% else %}
{# Fallback to basic OG tags if no structured data #}
<meta property="og:title" content="{{ post.title }}">
<meta property="og:type" content="article">
<meta property="og:url" content="{{ config.url }}{{ post.href }}">
{% if post.description %}
<meta property="og:description" content="{{ post.description }}">
{% endif %}
{% if post.date %}
<meta property="article:published_time" content="{{ post.date | atom_date }}">
{% endif %}
{% if config.post_formats.og %}
<meta property="og:image" content="{{ config.url }}{{ post.href }}og/">
{% endif %}
{% endif %}

{# Structured Data: Twitter Card meta tags #}
{% if post.structured_data.twitter %}
{% for meta in post.structured_data.twitter %}
<meta name="{{ meta.name }}" content="{{ meta.content }}">
{% endfor %}
{% endif %}
{% endblock %}

{% block content %}
<div class="content-wrapper{% if config.components.doc_sidebar.enabled and post.toc %} content-wrapper--with-sidebar content-wrapper--sidebar-{{ config.components.doc_sidebar.position | default:'right' }}{% endif %}">
    <article class="post h-entry" data-pagefind-body>
        {# Hidden canonical URL for microformats parsers #}
        <a class="u-url" href="{{ config.url }}{{ post.href }}" hidden></a>

        <header class="post-header">
            <h1 class="p-name" data-pagefind-meta="title">{{ post.title }}</h1>
            {% if post.description %}
            <p class="post-description p-summary visually-hidden" data-pagefind-meta="excerpt">{{ post.description | striptags }}</p>
            {% endif %}
            {# Pagefind image metadata for search thumbnails #}
            {% if post.cover_image %}
            <meta data-pagefind-meta="image[content]" content="{{ post.cover_image }}">
            {% elif post.Extra.image %}
            <meta data-pagefind-meta="image[content]" content="{{ post.Extra.image }}">
            {% elif post.Extra.thumbnail %}
            <meta data-pagefind-meta="image[content]" content="{{ post.Extra.thumbnail }}">
            {% elif config.seo.default_image %}
            <meta data-pagefind-meta="image[content]" content="{{ config.seo.default_image }}">
            {% endif %}
            {% if post.date or post.reading_time %}
            <div class="post-meta">
                {% if post.date %}<time class="dt-published" datetime="{{ post.date | atom_date }}">{{ post.date | date:"January 2, 2006" }}</time>{% endif %}
                {% if post.reading_time %}<span>{{ post.reading_time }} min read</span>{% endif %}
            </div>
            {% endif %}
            {# Author h-card (representative) #}
            {% if config.author %}
            <span class="p-author h-card" hidden>
                <a class="u-url p-name" href="{{ config.url }}">{{ config.author }}</a>
            </span>
            {% endif %}
            {% if post.tags %}
            <div class="tags">
                {% for tag in post.tags %}
                <a href="/tags/{{ tag | slugify }}/" class="tag p-category">{{ tag }}</a>
                {% endfor %}
            </div>
            {% endif %}
            {% if post.Extra.guide_order and post.PrevNextFeed %}
            <div class="guide-info">
                <span class="guide-part">Part {{ post.Extra.guide_order }}</span>
                {% if post.Extra.difficulty %}
                <span class="guide-difficulty guide-difficulty--{{ post.Extra.difficulty }}">{{ post.Extra.difficulty }}</span>
                {% endif %}
                {% if post.Extra.estimated_time %}
                <span class="guide-time">{{ post.Extra.estimated_time }}</span>
                {% endif %}
            </div>
            {% endif %}
        </header>

        <div class="post-content e-content{% if post.css_class %} {{ post.css_class }}{% endif %}">
            {{ body | safe }}
        </div>

        {# Guide series navigation #}
        {% include "partials/guide-navigation.html" %}

        {# Webmentions #}
        {% include "partials/webmentions.html" %}
    </article>

    {% include "components/doc_sidebar.html" %}
</div>
{% endblock %}
