{# Palette and Aesthetic Switcher UI Component #}
{# Rendered when config.theme.switcher.enabled is true #}
{# Contains: palette family dropdown, dark/light toggle, aesthetic dropdown #}

{% if config.theme.switcher.enabled %}
<div class="theme-switcher" data-pagefind-ignore>
  {# Dark/Light Mode Toggle #}
  <button class="palette-mode-toggle" type="button" aria-label="Toggle dark/light mode" title="Toggle dark/light mode">
    <span class="mode-icon" aria-hidden="true"></span>
  </button>

  {# Palette Family Selector #}
  <div class="palette-family-wrapper">
    <button class="palette-family-btn" type="button" aria-haspopup="listbox" aria-expanded="false">
      <span>Theme</span>
      <span class="palette-arrow" aria-hidden="true">&#9660;</span>
    </button>
    <div class="palette-family-dropdown" role="listbox" hidden>
      <div class="palette-search">
        <input type="text" placeholder="Search palettesâ€¦" aria-label="Search palettes" autocomplete="off">
      </div>
      <div class="palette-family-list">
        {# Family options are populated by palette-switcher.js from --palette-manifest #}
      </div>
    </div>
  </div>

  {# Aesthetic Selector #}
  <div class="aesthetic-wrapper">
    <select id="aesthetic-select" class="aesthetic-select" aria-label="Select aesthetic">
      <option value="brutal">Brutal</option>
      <option value="precision">Precision</option>
      <option value="balanced" selected>Balanced</option>
      <option value="elevated">Elevated</option>
      <option value="minimal">Minimal</option>
    </select>
  </div>
</div>

<style>
/* Aesthetic selector styling - matches palette-switcher design */
.aesthetic-wrapper {
  position: relative;
}

.aesthetic-select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  display: inline-flex;
  align-items: center;
  padding: 0.5rem 2rem 0.5rem 0.75rem;
  background: var(--color-surface, #f5f5f5);
  color: var(--color-text, #333);
  border: 1px solid var(--color-border, #ddd);
  border-radius: var(--radius-md, 0.375rem);
  font-size: var(--text-sm, 0.875rem);
  cursor: pointer;
  transition: background-color 0.15s ease, border-color 0.15s ease, color 0.15s ease;
  white-space: nowrap;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
  background-position: right 0.5rem center;
  background-repeat: no-repeat;
  background-size: 1.25rem 1.25rem;
}

.aesthetic-select:hover {
  background-color: var(--color-background, #fff);
  border-color: var(--color-primary, #6366f1);
}

.aesthetic-select:focus-visible {
  outline: 2px solid var(--color-primary, #6366f1);
  outline-offset: 2px;
}

.aesthetic-select option {
  background: var(--color-background, #fff);
  color: var(--color-text, #333);
  padding: 0.5rem;
}

/* Mobile responsiveness */
@media (max-width: 640px) {
  .aesthetic-select {
    padding: 0.375rem 1.75rem 0.375rem 0.5rem;
    font-size: var(--text-xs, 0.75rem);
  }
}

@media (max-width: 480px) {
  .aesthetic-select {
    max-width: 90px;
  }
}
</style>

<script>
(function() {
  'use strict';

  const AESTHETIC_KEY = 'selected-aesthetic';
  const DEFAULT_AESTHETIC = 'balanced';

  // Aesthetic definitions with their CSS custom property values
  const AESTHETICS = {
    brutal: {
      '--radius-sm': '0',
      '--radius-md': '0',
      '--radius-lg': '0',
      '--radius-xl': '0',
      '--spacing-scale': '1.25',
      '--border-width-thin': '1px',
      '--border-width-normal': '2px',
      '--border-width-thick': '4px',
      '--shadow-sm': 'none',
      '--shadow-md': '4px 4px 0 var(--color-border)',
      '--shadow-lg': '6px 6px 0 var(--color-border)',
      '--shadow-xl': '8px 8px 0 var(--color-border)',
      '--font-primary': 'var(--font-mono, monospace)',
      '--leading-scale': '1.5'
    },
    precision: {
      '--radius-sm': '2px',
      '--radius-md': '4px',
      '--radius-lg': '6px',
      '--radius-xl': '8px',
      '--spacing-scale': '1',
      '--border-width-thin': '1px',
      '--border-width-normal': '1px',
      '--border-width-thick': '2px',
      '--shadow-sm': '0 1px 2px rgba(0,0,0,0.04)',
      '--shadow-md': '0 2px 4px rgba(0,0,0,0.06)',
      '--shadow-lg': '0 4px 8px rgba(0,0,0,0.08)',
      '--shadow-xl': '0 8px 16px rgba(0,0,0,0.1)',
      '--font-primary': 'var(--font-body, system-ui)',
      '--leading-scale': '1.5'
    },
    balanced: {
      '--radius-sm': '4px',
      '--radius-md': '8px',
      '--radius-lg': '12px',
      '--radius-xl': '16px',
      '--spacing-scale': '1',
      '--border-width-thin': '1px',
      '--border-width-normal': '1px',
      '--border-width-thick': '2px',
      '--shadow-sm': '0 1px 3px rgba(0,0,0,0.08)',
      '--shadow-md': '0 4px 12px rgba(0,0,0,0.1)',
      '--shadow-lg': '0 8px 24px rgba(0,0,0,0.12)',
      '--shadow-xl': '0 12px 40px rgba(0,0,0,0.15)',
      '--font-primary': 'var(--font-body, system-ui)',
      '--leading-scale': '1.6'
    },
    elevated: {
      '--radius-sm': '8px',
      '--radius-md': '12px',
      '--radius-lg': '20px',
      '--radius-xl': '28px',
      '--spacing-scale': '1.15',
      '--border-width-thin': '1px',
      '--border-width-normal': '1px',
      '--border-width-thick': '2px',
      '--shadow-sm': '0 2px 8px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04)',
      '--shadow-md': '0 8px 24px rgba(0,0,0,0.1), 0 2px 8px rgba(0,0,0,0.06)',
      '--shadow-lg': '0 16px 48px rgba(0,0,0,0.12), 0 4px 12px rgba(0,0,0,0.08)',
      '--shadow-xl': '0 24px 64px rgba(0,0,0,0.15), 0 8px 24px rgba(0,0,0,0.1)',
      '--font-primary': 'var(--font-body, system-ui)',
      '--leading-scale': '1.7'
    },
    minimal: {
      '--radius-sm': '2px',
      '--radius-md': '4px',
      '--radius-lg': '6px',
      '--radius-xl': '8px',
      '--spacing-scale': '0.9',
      '--border-width-thin': '1px',
      '--border-width-normal': '1px',
      '--border-width-thick': '1px',
      '--shadow-sm': 'none',
      '--shadow-md': 'none',
      '--shadow-lg': '0 1px 3px rgba(0,0,0,0.05)',
      '--shadow-xl': '0 2px 6px rgba(0,0,0,0.08)',
      '--font-primary': 'var(--font-body, system-ui)',
      '--leading-scale': '1.6'
    }
  };

  function applyAesthetic(name) {
    const root = document.documentElement;
    const aesthetic = AESTHETICS[name] || AESTHETICS[DEFAULT_AESTHETIC];

    // Set data attribute for potential CSS targeting
    root.dataset.aesthetic = name;

    // Apply all CSS custom properties
    for (const [prop, value] of Object.entries(aesthetic)) {
      root.style.setProperty(prop, value);
    }

    // Persist selection
    localStorage.setItem(AESTHETIC_KEY, name);

    // Dispatch event for other components
    window.dispatchEvent(new CustomEvent('aesthetic-change', {
      detail: { aesthetic: name }
    }));
  }

  function initAesthetic() {
    const select = document.getElementById('aesthetic-select');
    if (!select) return;

    // Load saved aesthetic
    const saved = localStorage.getItem(AESTHETIC_KEY) || DEFAULT_AESTHETIC;
    select.value = saved;
    applyAesthetic(saved);

    // Handle changes - use global API if available (for consistency with keyboard shortcuts)
    select.addEventListener('change', (e) => {
      if (window.markata && window.markata.paletteSwitcher && window.markata.paletteSwitcher.setAesthetic) {
        window.markata.paletteSwitcher.setAesthetic(e.target.value);
      } else {
        applyAesthetic(e.target.value);
      }
    });

    // Listen for aesthetic changes from keyboard shortcuts
    window.addEventListener('aesthetic-change', (e) => {
      if (e.detail && e.detail.aesthetic && select.value !== e.detail.aesthetic) {
        select.value = e.detail.aesthetic;
      }
    });
  }

  // Initialize on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAesthetic);
  } else {
    initAesthetic();
  }

  // Expose API
  window.markata = window.markata || {};
  window.markata.aesthetic = {
    apply: applyAesthetic,
    get: () => localStorage.getItem(AESTHETIC_KEY) || DEFAULT_AESTHETIC,
    list: () => Object.keys(AESTHETICS)
  };
})();
</script>
{% endif %}
