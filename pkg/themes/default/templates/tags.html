{% extends "base.html" %}

{% block title %}{{ title | default:"Tags" }}{% endblock %}
{% block description %}{{ description | default:config.description | default:"" }}{% endblock %}

{% block content %}
<div class="tags-listing">
  <header class="page-header">
    <h1>{{ title | default:"Tags" }}</h1>
    {% if description %}<p class="page-description">{{ description }}</p>{% endif %}
    <p class="tags-count">{{ total_tags }} tag{{ total_tags|pluralize }} found</p>
  </header>

  {% if tag_list %}
  <div class="tags-controls">
    <button class="sort-btn" data-sort="alpha" aria-pressed="false">A–Z</button>
    <button class="sort-btn" data-sort="count" aria-pressed="false">By Count</button>
  </div>

  <div class="tags-cloud" id="tags-cloud">
    {% for tag in tag_list %}
    <a href="{{ tag.Href }}" class="tag-item" data-count="{{ tag.Count }}" data-name="{{ tag.Name }}">
      <span class="tag-name">{{ tag.Name }}</span>
      <span class="tag-count">({{ tag.Count }})</span>
    </a>
    {% endfor %}
  </div>
  {% else %}
  <p class="no-tags">No tags found.</p>
  {% endif %}
</div>

<style>
.tags-listing {
  max-width: var(--content-width, 800px);
  margin: 0 auto;
  padding: var(--spacing-lg, 2rem);
}

.page-header {
  margin-bottom: var(--spacing-xl, 3rem);
  text-align: center;
}

.page-header h1 {
  margin-bottom: var(--spacing-sm, 0.5rem);
}

.page-description {
  color: var(--color-text-muted, #666);
  margin-bottom: var(--spacing-sm, 0.5rem);
}

.tags-count {
  color: var(--color-text-muted, #666);
  font-size: 0.9em;
}

.tags-controls {
  display: flex;
  gap: var(--spacing-sm, 0.5rem);
  justify-content: center;
  margin-bottom: var(--spacing-lg, 2rem);
  flex-wrap: wrap;
}

.sort-btn {
  padding: var(--spacing-xs, 0.25rem) var(--spacing-sm, 0.5rem);
  border: 1px solid var(--color-border, #ddd);
  background: var(--color-background, #fff);
  color: var(--color-text, #333);
  border-radius: var(--radius-md, 0.25rem);
  cursor: pointer;
  font-size: 0.9em;
  font-weight: 500;
  transition: all 0.2s ease;
}

.sort-btn:hover {
  border-color: var(--color-primary, #007bff);
  color: var(--color-primary, #007bff);
}

.sort-btn[aria-pressed="true"] {
  background: var(--color-primary, #007bff);
  border-color: var(--color-primary, #007bff);
  color: var(--color-background, #fff);
}

.sort-btn[aria-pressed="true"]::after {
  content: " ↓";
}

.sort-btn[data-reversed="true"]::after {
  content: " ↑" !important;
}

.tags-cloud {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-sm, 0.5rem);
  justify-content: center;
  margin-bottom: var(--spacing-xl, 3rem);
  padding: var(--spacing-lg, 2rem);
  background: var(--color-surface, #f5f5f5);
  border-radius: var(--radius-lg, 0.5rem);
}

.tag-item {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: var(--spacing-xs, 0.25rem) var(--spacing-sm, 0.5rem);
  background: var(--color-background, #fff);
  border: 1px solid var(--color-border, #ddd);
  border-radius: var(--radius-md, 0.25rem);
  text-decoration: none;
  color: var(--color-text, #333);
  transition: all 0.2s ease;
}

.tag-item:hover {
  background: var(--color-primary, #007bff);
  border-color: var(--color-primary, #007bff);
  color: var(--color-background, #fff);
  transform: translateY(-2px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.tag-name {
  font-weight: 500;
}

.tag-count {
  font-size: 0.85em;
  opacity: 0.7;
}

/* Responsive */
@media (max-width: 600px) {
  .tags-listing {
    padding: var(--spacing-md, 1rem);
  }

  .tags-cloud {
    padding: var(--spacing-md, 1rem);
  }

  .tags-controls {
    gap: var(--spacing-xs, 0.25rem);
  }

  .sort-btn {
    padding: var(--spacing-xs, 0.25rem) var(--spacing-xs, 0.25rem);
    font-size: 0.85em;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const cloud = document.getElementById('tags-cloud');
  if (!cloud) return;

  const buttons = document.querySelectorAll('.sort-btn');
  let currentSort = null;
  let isReversed = false;

  buttons.forEach(btn => {
    btn.addEventListener('click', function() {
      const sortType = this.dataset.sort;

      // If clicking the same button, toggle reverse
      if (currentSort === sortType) {
        isReversed = !isReversed;
      } else {
        // Switch to new sort, reset reverse
        currentSort = sortType;
        isReversed = false;

        // Update button states
        buttons.forEach(b => {
          b.setAttribute('aria-pressed', 'false');
          b.removeAttribute('data-reversed');
        });
        this.setAttribute('aria-pressed', 'true');
      }

      // Update reversed state on active button
      if (isReversed) {
        this.setAttribute('data-reversed', 'true');
      } else {
        this.removeAttribute('data-reversed');
      }

      sortTags(sortType, isReversed);
    });
  });

  function sortTags(sortType, reverse) {
    const items = Array.from(cloud.querySelectorAll('.tag-item'));

    items.sort((a, b) => {
      let aValue, bValue;

      if (sortType === 'alpha') {
        aValue = a.dataset.name.toLowerCase();
        bValue = b.dataset.name.toLowerCase();
        return reverse
          ? bValue.localeCompare(aValue)
          : aValue.localeCompare(bValue);
      } else if (sortType === 'count') {
        aValue = parseInt(a.dataset.count, 10);
        bValue = parseInt(b.dataset.count, 10);
        return reverse
          ? aValue - bValue
          : bValue - aValue;
      }

      return 0;
    });

    // Re-render sorted items
    items.forEach(item => cloud.appendChild(item));
  }
});
</script>
{% endblock %}
