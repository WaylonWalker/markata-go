<!DOCTYPE html>
<html lang="{{ config.lang | default:'en' }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  {% block meta %}
  <title>{% block title %}{{ config.title | default:'My Site' }}{% endblock %}</title>
  <meta name="description" content="{% block description %}{{ config.description | default:'' }}{% endblock %}">
  {% endblock %}

  {% block head %}
  <!-- Theme CSS -->
  <link rel="stylesheet" href="{{ 'css/variables.css' | theme_asset }}">
  <link rel="stylesheet" href="{{ 'css/main.css' | theme_asset }}">
  <link rel="stylesheet" href="{{ 'css/components.css' | theme_asset }}">
  <link rel="stylesheet" href="{{ 'css/admonitions.css' | theme_asset }}">
  <link rel="stylesheet" href="{{ 'css/code.css' | theme_asset }}">
  <link rel="stylesheet" href="/css/chroma.css">

  <!-- GLightbox CSS for image zoom -->
  {% if config.Extra.glightbox_enabled %}
  {% if config.Extra.glightbox_cdn %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  {% else %}
  <link rel="stylesheet" href="/css/glightbox.min.css">
  {% endif %}
  {% endif %}

  <!-- CSS variable overrides from theme config -->
  {% if config.theme.variables %}
  <style>:root { {% for k, v in config.theme.variables.items() %}{{ k }}: {{ v }}; {% endfor %} }</style>
  {% endif %}

  <!-- Style config overrides (per HEAD_STYLE.md spec) -->
  {% if config.style %}
  <style>
    :root {
      {% if config.style.color_bg %}--color-background: {{ config.style.color_bg }};{% endif %}
      {% if config.style.color_text %}--color-text: {{ config.style.color_text }};{% endif %}
      {% if config.style.color_link %}--color-primary: {{ config.style.color_link }};{% endif %}
      {% if config.style.color_accent %}--color-primary-dark: {{ config.style.color_accent }};{% endif %}
      {% if config.style.body_width %}--content-width: {{ config.style.body_width }};{% endif %}
    }
    @media (prefers-color-scheme: light) {
      :root {
        {% if config.style.color_bg_light %}--color-background: {{ config.style.color_bg_light }};{% endif %}
        {% if config.style.color_text_light %}--color-text: {{ config.style.color_text_light }};{% endif %}
        {% if config.style.color_link_light %}--color-primary: {{ config.style.color_link_light }};{% endif %}
        {% if config.style.color_accent_light %}--color-primary-dark: {{ config.style.color_accent_light }};{% endif %}
      }
    }
  </style>
  {% endif %}

  <!-- Custom CSS file -->
  {% if config.theme.custom_css %}
  <link rel="stylesheet" href="{{ config.theme.custom_css | asset_url }}">
  {% endif %}

  <!-- RSS/Atom/JSON Feeds -->
  {% if config.head.alternate_feeds %}
  {% for feed in config.head.alternate_feeds %}
  <link rel="alternate" type="{{ feed.mime_type }}" title="{{ feed.title }}" href="{{ feed.href }}">
  {% endfor %}
  {% else %}
  {# Default feeds when no alternate_feeds configured #}
  <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml">
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/atom.xml">
  {% endif %}

  <!-- Global head config (per HEAD_STYLE.md spec) -->
  {% if config.head %}
    <!-- Raw text/HTML -->
    {% if config.head.text %}{{ config.head.text | safe }}{% endif %}

    <!-- Meta tags -->
    {% for meta in config.head.meta %}
      {% if meta.name %}
      <meta name="{{ meta.name }}" content="{{ meta.content }}">
      {% elif meta.property %}
      <meta property="{{ meta.property }}" content="{{ meta.content }}">
      {% endif %}
    {% endfor %}

    <!-- Link tags -->
    {% for link in config.head.link %}
    <link rel="{{ link.rel }}" href="{{ link.href }}"{% if link.crossorigin %} crossorigin{% endif %}>
    {% endfor %}

    <!-- Script tags -->
    {% for script in config.head.script %}
    <script src="{{ script.src }}"></script>
    {% endfor %}
  {% endif %}

  {% include "partials/background-css.html" %}
  {% endblock %}
</head>
<body>
  {% include "partials/background-decorations.html" %}
  {% block header %}
  <header class="site-header">
    <div class="container">
      <a href="/" class="site-title">{{ config.title | default:'My Site' }}</a>
      {% include "components/nav.html" %}
    </div>
  </header>
  {% endblock %}

  <div class="page-wrapper">
    {# Left sidebar for feed navigation (if enabled) #}
    {% if config.components.feed_sidebar.enabled and config.components.feed_sidebar.position == 'left' %}
    {% include "components/feed_sidebar.html" %}
    {% endif %}

    <main class="main-content">
      {% block content %}{% endblock %}
    </main>

    {# Right sidebar for document TOC (if enabled) #}
    {% if config.components.doc_sidebar.enabled and config.components.doc_sidebar.position == 'right' %}
    {% include "components/doc_sidebar.html" %}
    {% endif %}
  </div>

  {% block footer %}
  {% include "components/footer.html" %}
  {% endblock %}

  {% block htmx %}{% endblock %}
  {% block scripts %}{% endblock %}

  <!-- GLightbox JS for image zoom -->
  {% if config.Extra.glightbox_enabled %}
  {% if config.Extra.glightbox_cdn %}
  <script src="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/js/glightbox.min.js"></script>
  {% else %}
  <script src="/js/glightbox.min.js"></script>
  {% endif %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const lightbox = GLightbox({
        selector: '{{ config.Extra.glightbox_options.selector | default:".glightbox" }}',
        openEffect: '{{ config.Extra.glightbox_options.openEffect | default:"zoom" }}',
        closeEffect: '{{ config.Extra.glightbox_options.closeEffect | default:"zoom" }}',
        slideEffect: '{{ config.Extra.glightbox_options.slideEffect | default:"slide" }}',
        touchNavigation: {{ config.Extra.glightbox_options.touchNavigation | default:true | yesno:"true,false" }},
        loop: {{ config.Extra.glightbox_options.loop | default:false | yesno:"true,false" }},
        draggable: {{ config.Extra.glightbox_options.draggable | default:true | yesno:"true,false" }}
      });
    });
  </script>
  {% endif %}

  {% include "partials/background-scripts.html" %}
</body>
</html>
