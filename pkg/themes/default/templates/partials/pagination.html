{# Pagination partial - auto-selects template based on pagination_type #}
{# Ellipsis pagination: shows 1, ..., current-2 to current+2, ..., last #}
{% if page.total_pages > 1 %}
{% if page.pagination_type == "htmx" %}
{# HTMX Pagination - uses hx-* attributes for AJAX loading #}
<nav id="pagination-nav" class="pagination pagination-htmx" aria-label="Pagination" hx-boost="true" hx-swap="outerHTML">
  {# Previous button #}
  {% if page.has_prev %}
   <a href="{{ page.prev_url }}"
      class="pagination-prev"
      rel="prev"
      hx-get="{{ page.prev_url }}"
      hx-target=".posts-list"
      hx-select=".posts-list"
      hx-swap="outerHTML swap:*"
      hx-push-url="true">&laquo; Newer</a>
  {% else %}
  <span class="pagination-prev disabled">&laquo; Newer</span>
  {% endif %}

  {# Page numbers with ellipsis #}
  <div class="pagination-pages">
    {% for url in page.page_urls %}
    {% with page_num=forloop.Counter %}
    {# Show page if: first page, last page, or within 2 of current page #}
    {% if page_num == 1 or page_num == page.total_pages or (page_num >= page.number|add:"-2" and page_num <= page.number|add:"2") %}
      {# Show ellipsis before this page if there's a gap #}
      {% if page_num == page.total_pages and page.number < page.total_pages|add:"-3" %}
      <span class="pagination-ellipsis" aria-hidden="true">...</span>
      {% elif page_num > 1 and page_num == page.number|add:"-2" and page.number > 4 %}
      <span class="pagination-ellipsis" aria-hidden="true">...</span>
      {% endif %}
      {% if page_num == page.number %}
      <span class="pagination-page current" aria-current="page">{{ page_num }}</span>
      {% else %}
       <a href="{{ url }}"
          class="pagination-page"
          hx-get="{{ url }}"
          hx-target=".posts-list"
          hx-select=".posts-list"
          hx-swap="outerHTML swap:*"
          hx-push-url="true">{{ page_num }}</a>
      {% endif %}
      {# Show ellipsis after page 1 if there's a gap #}
      {% if page_num == 1 and page.number > 4 %}
      <span class="pagination-ellipsis" aria-hidden="true">...</span>
      {% endif %}
    {% endif %}
    {% endwith %}
    {% endfor %}
  </div>

  {# Next button #}
  {% if page.has_next %}
   <a href="{{ page.next_url }}"
      class="pagination-next"
      rel="next"
      hx-get="{{ page.next_url }}"
      hx-target=".posts-list"
      hx-select=".posts-list"
      hx-swap="outerHTML swap:*"
      hx-push-url="true">Older &raquo;</a>
  {% else %}
  <span class="pagination-next disabled">Older &raquo;</span>
  {% endif %}
</nav>
{% elif page.pagination_type == "js" %}
{# JavaScript Pagination - client-side with all posts loaded #}
<nav class="pagination pagination-js" aria-label="Pagination"
     data-feed-slug="{{ feed.slug }}"
     data-items-per-page="{{ page.items_per_page }}"
     data-total-pages="{{ page.total_pages }}"
     data-current-page="{{ page.number }}">
  <button class="pagination-prev" data-action="prev" disabled>&laquo; Newer</button>

  <div class="pagination-pages">
    {# Page numbers will be generated by JavaScript #}
  </div>

  <button class="pagination-next" data-action="next">Older &raquo;</button>
</nav>
<noscript>
  {# Fallback to manual pagination when JS is disabled #}
  <nav class="pagination" aria-label="Pagination">
    {% if page.has_prev %}
    <a href="{{ page.prev_url }}" class="pagination-prev" rel="prev">&laquo; Newer</a>
    {% else %}
    <span class="pagination-prev disabled">&laquo; Newer</span>
    {% endif %}
    <div class="pagination-pages">
      {% for url in page.page_urls %}
      {% with page_num=forloop.Counter %}
      {% if page_num == 1 or page_num == page.total_pages or (page_num >= page.number|add:"-2" and page_num <= page.number|add:"2") %}
        {% if page_num == page.total_pages and page.number < page.total_pages|add:"-3" %}
        <span class="pagination-ellipsis" aria-hidden="true">...</span>
        {% elif page_num > 1 and page_num == page.number|add:"-2" and page.number > 4 %}
        <span class="pagination-ellipsis" aria-hidden="true">...</span>
        {% endif %}
        {% if page_num == page.number %}
        <span class="pagination-page current" aria-current="page">{{ page_num }}</span>
        {% else %}
        <a href="{{ url }}" class="pagination-page">{{ page_num }}</a>
        {% endif %}
        {% if page_num == 1 and page.number > 4 %}
        <span class="pagination-ellipsis" aria-hidden="true">...</span>
        {% endif %}
      {% endif %}
      {% endwith %}
      {% endfor %}
    </div>
    {% if page.has_next %}
    <a href="{{ page.next_url }}" class="pagination-next" rel="next">Older &raquo;</a>
    {% else %}
    <span class="pagination-next disabled">Older &raquo;</span>
    {% endif %}
  </nav>
</noscript>
{% else %}
{# Manual Pagination (default) - traditional page links #}
<nav class="pagination" aria-label="Pagination">
  {# Previous button #}
  {% if page.has_prev %}
  <a href="{{ page.prev_url }}" class="pagination-prev" rel="prev">&laquo; Newer</a>
  {% else %}
  <span class="pagination-prev disabled">&laquo; Newer</span>
  {% endif %}

  {# Page numbers with ellipsis #}
  <div class="pagination-pages">
    {% for url in page.page_urls %}
    {% with page_num=forloop.Counter %}
    {# Show page if: first page, last page, or within 2 of current page #}
    {% if page_num == 1 or page_num == page.total_pages or (page_num >= page.number|add:"-2" and page_num <= page.number|add:"2") %}
      {# Show ellipsis before this page if there's a gap #}
      {% if page_num == page.total_pages and page.number < page.total_pages|add:"-3" %}
      <span class="pagination-ellipsis" aria-hidden="true">...</span>
      {% elif page_num > 1 and page_num == page.number|add:"-2" and page.number > 4 %}
      <span class="pagination-ellipsis" aria-hidden="true">...</span>
      {% endif %}
      {% if page_num == page.number %}
      <span class="pagination-page current" aria-current="page">{{ page_num }}</span>
      {% else %}
      <a href="{{ url }}" class="pagination-page">{{ page_num }}</a>
      {% endif %}
      {# Show ellipsis after page 1 if there's a gap #}
      {% if page_num == 1 and page.number > 4 %}
      <span class="pagination-ellipsis" aria-hidden="true">...</span>
      {% endif %}
    {% endif %}
    {% endwith %}
    {% endfor %}
  </div>

  {# Next button #}
  {% if page.has_next %}
  <a href="{{ page.next_url }}" class="pagination-next" rel="next">Older &raquo;</a>
  {% else %}
  <span class="pagination-next disabled">Older &raquo;</span>
  {% endif %}
</nav>
{% endif %}
{% endif %}
