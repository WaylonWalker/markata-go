{# Reader Page - Aggregated posts from blogroll feeds #}
{% extends "base.html" %}

{% block title %}{{ title | default:"Reader" }}{% if page.number > 1 %} - Page {{ page.number }}{% endif %} - {{ config.title | default:"My Site" }}{% endblock %}
{% block description %}{{ description | default:"Latest posts from blogs I follow" }}{% endblock %}

{% block body_class %}page-reader{% endblock %}

{% block head_extra %}
{% if pagination_type == "htmx" %}
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
{% endif %}
{% endblock %}

{% block content %}
<div class="reader-page">
  <header class="reader-header">
    <h1>{{ title | default:"Reader" }}</h1>
    <p class="reader-subtitle">{{ description | default:"Latest posts from blogs I follow" }}</p>
  </header>

  <nav class="reader-nav" aria-label="Page navigation">
    <a href="/blogroll/">View Blogroll</a>
  </nav>

  {% if pagination_type == "htmx" %}
  <div id="reader-content">
  {% endif %}

  <ul class="reader-entries">
    {% for entry in entries %}
    <li class="reader-entry">
      <article class="reader-entry-article{% if entry.image_url %} has-image{% endif %}">
        {% if entry.image_url %}
        <a href="{{ entry.url }}" target="_blank" rel="noopener" class="reader-entry-image-link">
          <img src="{{ entry.image_url }}" alt="" class="reader-entry-image" loading="lazy">
        </a>
        {% endif %}
        <div class="reader-entry-content">
          <h2 class="reader-entry-title">
            <a href="{{ entry.url }}" target="_blank" rel="noopener">{{ entry.title }}</a>
          </h2>
          <div class="reader-entry-meta">
            <span class="reader-entry-source">{{ entry.feed_title }}</span>
            {% if entry.published %}
            <time datetime="{{ entry.published | atom_date }}">{{ entry.published | date:"Jan 2, 2006" }}</time>
            {% endif %}
          </div>
          {% if entry.description %}
          <p class="reader-entry-description">{{ entry.description | striptags | truncatewords:40 }}</p>
          {% endif %}
        </div>
      </article>
    </li>
    {% endfor %}
  </ul>

  {# Pagination Navigation #}
  {% if page.total_pages > 1 %}
  <nav class="pagination" aria-label="Page navigation">
    {% if page.has_prev %}
      {% if pagination_type == "htmx" %}
      <a href="{{ page.prev_url }}" hx-get="{{ page.prev_url }}partial/" hx-target="#reader-content" hx-swap="innerHTML">&laquo; Previous</a>
      {% else %}
      <a href="{{ page.prev_url }}">&laquo; Previous</a>
      {% endif %}
    {% else %}
    <span class="pagination-disabled">&laquo; Previous</span>
    {% endif %}

    {% for url in page.page_urls %}
    {% set page_num = forloop.Counter %}
    {% if page_num == page.number %}
    <span class="pagination-current">{{ page_num }}</span>
    {% else %}
      {% if pagination_type == "htmx" %}
      <a href="{{ url }}" hx-get="{{ url }}partial/" hx-target="#reader-content" hx-swap="innerHTML">{{ page_num }}</a>
      {% else %}
      <a href="{{ url }}">{{ page_num }}</a>
      {% endif %}
    {% endif %}
    {% endfor %}

    {% if page.has_next %}
      {% if pagination_type == "htmx" %}
      <a href="{{ page.next_url }}" hx-get="{{ page.next_url }}partial/" hx-target="#reader-content" hx-swap="innerHTML">Next &raquo;</a>
      {% else %}
      <a href="{{ page.next_url }}">Next &raquo;</a>
      {% endif %}
    {% else %}
    <span class="pagination-disabled">Next &raquo;</span>
    {% endif %}
  </nav>
  {% endif %}

  {% if pagination_type == "htmx" %}
  </div>
  {% endif %}
</div>
{% endblock %}
